<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>CS171 Final Project: Does Money Matter?</title>

  <link
          rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
          integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N"
          crossorigin="anonymous"
  />

  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
<!-- WRAPPER -->
<div class="container-fluid" style="height: 100vh; padding-top: 1vh">
  <div class="row">
    <div class="col-10 offset-1">
      <!-- HEADING -->
      <div class="row" style="height: 50vh; padding: 0">
        <div class="align-self-center px-4" id="heading">
          <h1 class="title">Does Money Matter?</h1>
          <h3 class="subtitle">All about recent senate campaign donations</h3>
          <p class="heading">Campaign funding has a profound impact on the political landscape and scrutinizing where these funds come from can tell us a lot about who a candidate is and the type of leader they will be. Insights about where money is sourced from when it comes to political campaigns give the ordinary constituent important information that can aid decisions about who to support, who to campaign for, and ultimately where their vote should go. Money holds power, and when it comes to campaign donations, that money holds power over policy decisions and public trust. Understanding where these funds come from is key to having transparent, fair, informed, and accountable political races.</p>
          <i>So then we ask, who funds some of our most high-profile political candidates? What industries do they come from? How much are these donors willing to shell out to have some sway in a given race?</i>

        </div>
      </div>
      <div class="row justify-content-center align-items-center py-4">
        <div class="col-12">
          <h4 id="map-title"></h4>
        </div>
        <div class="col-9" id="map-svg"></div>
        <div class="col-2">
          <div class="row">
            <label for="map-fill-select">Map Fill:</label>
            <select class="form-control" id="map-fill-select">
              <option value="all" selected>All states</option>
              <option value="100m">>$100M states</option>
            </select>
          </div>
          <div class="row my-3" id="race-info">
            States with more than $100 million in total contributions are
            clickable.
          </div>
        </div>
        <div>
          <p>The cost displayed is the total money raised by all candidates in the race.<br>
            Click on senate races that cost more than $100M to learn more.</p>
        </div>
      </div>
      <div class="col justify-content-center">
        <div class="row">
          <h4 id="tree-map-title"></h4>
        </div>
        <div class="row my-2">
          <label for="map-fill-select">Select sectors:</label>
          <select class="form-control" id="map-tree-select">
            <option value="none" selected>Include Coded and Itemized Contributions</option>
            <option value="unitemized">Include Unitemized</option>
            <option value="uncoded">Include Uncoded</option>
            <option value="all">Include All Sectors</option>
          </select>
        </div>
        <div class="row my-2">
          <label for="map-tree-candidate-select">Select candidate:</label>
          <select class="form-control" id="map-tree-candidate-select"></select>
        </div>
        <div class="row" id="treeMap"></div>
        <p class="my-2">Those that fall below a state's reporting threshold for disclosing identifying information about the donor. For example: a contributor who gives $60 in a state where the disclosure reporting threshold is $100 is not required to be identified by name. The $60 is instead lumped in with other contributions that are below $100, and then classified as “unitemized.”</p>
        <div class="row justify-content-center">
          <div class="col-10">

            <h4 id="bar-chart-title"></h4>

            <div class="container-fluid" id="barChart"></div>
          </div>
          <div>
            <p>Within each broad sector, donors come from a multitude of different careers and employment fields. Here we are looking at the greatest contributing fields within a sector. </p>
          </div>
        </div>
        <div class="row justify-content-center">
          <div class="col-10" id="sankeyPlot"></div>
        </div>
      </div>
      <div class="my-5 py-5"></div>
    </div>
  </div>
</body>

<!-- - - - - - - - - - - - >
<    Load JS libraries     >
<- - - - - - - - - - - - -->

<!-- BOOTSTRAP -->
<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"
></script>

<!-- d3 -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://d3js.org/d3-array.v2.min.js"></script>
<script src="https://d3js.org/d3-geo.v2.min.js"></script>

<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/topojson.v2.min.js"></script>
<script src="https://d3js.org/d3-geo.v1.min.js"></script>
<!--    <script src="https://d3js.org/d3-sankey.v0.12.min.js"></script>-->
<script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/sankey.js"></script>
<script src="https://unpkg.com/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>


<!-- OWN JS -->
<script src="js/mapVis.js"></script>
<script src="js/circleVis.js"></script>
<!--    <script src="js/pieChart.js"></script>-->
<script src="js/treeMap.js"></script>
<script src="js/sankeyPlot.js"></script>
<script src="js/divergingBar.js"></script>
<script src="js/main.js"></script>
</html>




<!--
///-&#45;&#45;Sankey Work in progress-&#45;&#45;///

&#45;&#45;just need to remove hard-coded values and fix the position vlaues&#45;&#45;

<div>
  <script>
    var margin = {top: 10, right: 10, bottom: 10, left: 10},
            width =900 - margin.left - margin.right,
            height = 300 - margin.top - margin.bottom;

    var formatNumber = d3.format(",.0f"),
            format = function(d) { return formatNumber(d); },
            color = d3.scaleOrdinal(d3.schemeCategory10);

    var svg = d3.select("body").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var sankey = d3.sankey()
            .nodeWidth(36)
            .nodePadding(40)
            .size([width, height]);
    //.extent([[1, 1], [width - 1, height - 5]]);

    var path = d3.sankeyLinkHorizontal();

    // Function to clean the $ string and convert it to a number
    function parseMoney(currencyString) {
      return parseFloat(currencyString.replace(/[^0-9.-]+/g, ""));
    }

    d3.csv("data/candidate_totals/arizona.csv").then(function(rawData) {

      console.log("raw data:", rawData);

      var nodesByName = new Map();
      var links = [];

      rawData.forEach(function(d) {
        var source = nodesByName.get(d.broad_sector);
        var target = nodesByName.get(d.candidate);
        var value = parseMoney(d.total_$);
        //var value = 10;

        if (isNaN(value)) {
          console.error("Invalid value for total_$", d);
          return; // Skip this iteration.
        }

        if (!source) {
          source = {name: d.broad_sector, category: 'broad_sector'};
          nodesByName.set(d.broad_sector, source);
        }
        if (!target) {
          target = {name: d.candidate, category: 'candidate'};
          nodesByName.set(d.candidate, target);
        }
        links.push({source: source, target: target, value: value});
      });

      console.log("Nodes before sankey:", nodesByName);
      console.log("Links before sankey:", links);

      var nodes = Array.from(nodesByName.values());

      links.forEach(function(link) {
        link.source = nodes.indexOf(link.source);
        link.target = nodes.indexOf(link.target);
      });
      console.log("Nodes after indexing", nodes); // Check the processed nodes.
      console.log("Links after indexing", links); // Check the processed links.

      // Set up the Sankey diagram with nodes and links.
      //let sankeyData = {nodes, links};

      //sankey(sankeyData);

      sankey({
        nodes: nodes.map(d => Object.assign({}, d)), // create a copy of each node
        links: links.map(d => Object.assign({}, d)) // copy of each link
      });

      nodes.forEach(function(node, i) {
        // Just an example, would calculate these based on your actual layout
        node.x0 = i * (width / nodes.length);
        node.x1 = node.x0 + 25; // Node width of 25
        node.y0 = i * (height / nodes.length);
        node.y1 = node.y0 + 10; // Node height of 10
      });

      links.forEach(function(link, i) {
        // Manually set a width for the link
        link.width = 5; // Hardcoded width of 5
      });

      // Check if the sankey layout computation added the properties correctly
      console.log("Sankey nodes after layout", nodes);
      console.log("Sankey links after layout", links);

      nodes.forEach(node => {
        if (isNaN(node.x0) || isNaN(node.x1) || isNaN(node.y0) || isNaN(node.y1)) {
          console.error("Node with NaN position", node);
        }
      });

      links.forEach(link => {
        if (isNaN(link.width)) {
          console.error("Link with NaN width", link);
        }
      });


      /*        svg.append("g")
                  .selectAll(".link")
                  .data(links)
                  .enter().append("path")
                  .attr("class", "link")
                  .attr("d", path)
                  .style("stroke-width", function(d) { return Math.max(1, d.width); })
                  .append("title")
                  .text(function(d) {
                      return d.source.name + " → " + d.target.name + "\n" + format(d.value);
                  });*/

      function customSankeyLinkPath(sourceX, sourceY, targetX, targetY) {
        // This function creates a simple straight line between source and target
        return `M${sourceX},${sourceY}L${targetX},${targetY}`;
      }

      svg.append("g")
              .selectAll(".link")
              .data(links)
              .enter().append("path")
              .attr("class", "link")
              .attr("d", function(d) {
                //  y0 is the vertical center of the source node?
                var sourceX = nodes[d.source].x1; // Right side of the source node
                var sourceY = nodes[d.source].y0 + (nodes[d.source].y1 - nodes[d.source].y0) / 2; // Vertical center
                var targetX = nodes[d.target].x0; // Left side of the target node
                var targetY = nodes[d.target].y0 + (nodes[d.target].y1 - nodes[d.target].y0) / 2; // Vertical center
                return customSankeyLinkPath(sourceX, sourceY, targetX, targetY);
              })
              .style("stroke-width", function(d) { return d.width; })
              .append("title")
              .text(function(d) {
                return nodes[d.source].name + " → " + nodes[d.target].name + "\n" + format(d.value);
              });

      var node = svg.append("g")
              .selectAll(".node")
              .data(nodes)
              .enter().append("g")
              .attr("class", "node");

      node.append("rect")
              .attr("x", function(d) { return d.x0; })
              .attr("y", function(d) { return d.y0; })
              .attr("height", function(d) { return d.y1 - d.y0; })
              .attr("width", sankey.nodeWidth())
              .style("fill", function(d) { return color(d.name); })
              .append("title")
              .text(function(d) { return d.name + "\n" + format(d.value); });

      node.append("text")
              .attr("x", function(d) { return d.x0 - 6; })
              .attr("y", function(d) { return (d.y1 + d.y0) / 2; })
              .attr("dy", "0.35em")
              .attr("text-anchor", "end")
              .text(function(d) { return d.name; });
    });

  </script>
</div>

-->
