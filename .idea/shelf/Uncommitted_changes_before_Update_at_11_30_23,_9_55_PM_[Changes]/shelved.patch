Index: index.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\" />\n    <title>CS171 Final Project: Does Money Matter?</title>\n\n    <link\n      rel=\"stylesheet\"\n      href=\"https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css\"\n      integrity=\"sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N\"\n      crossorigin=\"anonymous\"\n    />\n\n    <link rel=\"stylesheet\" href=\"css/styles.css\" />\n  </head>\n  <body>\n    <!-- WRAPPER -->\n    <div class=\"container-fluid\" style=\"height: 100vh; padding-top: 1vh\">\n      <div class=\"row\">\n        <div class=\"col-10 offset-1\">\n          <!-- HEADING -->\n          <div class=\"row\" style=\"height: 10vh; padding: 0\">\n            <div class=\"align-self-center px-4\">\n              <h1>Does Money Matter?</h1>\n              <h3>All about recent senate campaign donations</h3>\n            </div>\n          </div>\n          <div class=\"row justify-content-center align-items-center py-4\">\n            <h4 id=\"map-title\"></h4>\n            <div class=\"col-9\" id=\"map-svg\"></div>\n            <div class=\"col-2\">\n              <div class=\"row\">\n                <label for=\"map-fill-select\">Map Fill:</label>\n                <select class=\"form-control\" id=\"map-fill-select\">\n                  <option value=\"all\" selected>All states</option>\n                  <option value=\"100m\">>$100M states</option>\n                </select>\n              </div>\n              <div class=\"row my-3\"><table></table></div>\n            </div>\n            <div>\n              <p>The cost displayed is the total money raised by all candidates in the race.<br>\n                Click on senate races that cost more than $100M to learn more.</p>\n            </div>\n          </div>\n          <div class=\"row justify-content-center\">\n            <div class=\"col-10\" id=\"pieDivRight\"></div>\n          </div>\n          <div class=\"col justify-content-center\">\n            <div class=\"row\">\n              <h4 id=\"tree-map-title\"></h4>\n            </div>\n            <div class=\"row-5\">\n              <label for=\"map-fill-select\">Select sectors:</label>\n              <select class=\"form-control\" id=\"map-tree-select\">\n                <option value=\"none\" selected>Include Coded and Itemized Contributions</option>\n                <option value=\"unitemized\">Include Unitemized</option>\n                <option value=\"uncoded\">Include Uncoded</option>\n                <option value=\"all\">Include All Sectors</option>\n              </select>\n            </div>\n            <div class=\"row\" id=\"treeMap\"></div>\n          <div class=\"row justify-content-center\">\n            <div id=\"barChart\"></div>\n          </div>\n          <div class=\"row justify-content-center\">\n            <div class=\"col-10\" id=\"sankeyPlot\"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- - - - - - - - - - - - >\n<    Load JS libraries     >\n<- - - - - - - - - - - - -->\n\n    <!-- BOOTSTRAP -->\n    <script\n      src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js\"\n      integrity=\"sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p\"\n      crossorigin=\"anonymous\"\n    ></script>\n\n    <!-- d3 -->\n    <script src=\"https://d3js.org/d3.v7.min.js\"></script>\n    <script src=\"https://d3js.org/d3-array.v2.min.js\"></script>\n    <script src=\"https://d3js.org/d3-geo.v2.min.js\"></script>\n\n    <script src=\"https://d3js.org/d3-scale-chromatic.v1.min.js\"></script>\n    <script src=\"https://d3js.org/topojson.v2.min.js\"></script>\n    <script src=\"https://d3js.org/d3-geo.v1.min.js\"></script>\n<!--    <script src=\"https://d3js.org/d3-sankey.v0.12.min.js\"></script>-->\n      <script src=\"https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/sankey.js\"></script>\n\n\n      <!-- OWN JS -->\n    <script src=\"js/mapVis.js\"></script>\n    <script src=\"js/circleVis.js\"></script>\n    <script src=\"js/pieChart.js\"></script>\n    <script src=\"js/treeMap.js\"></script>\n    <script src=\"js/sankeyPlot.js\"></script>\n    <script src=\"js/divergingBar.js\"></script>\n    <script src=\"js/main.js\"></script>\n  </body>\n</html>\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/index.html b/index.html
--- a/index.html	(revision 2c20c8b30e9d2dca31deede61497560c2c7f4fae)
+++ b/index.html	(date 1701397792811)
@@ -60,7 +60,8 @@
               </select>
             </div>
             <div class="row" id="treeMap"></div>
-          <div class="row justify-content-center">
+            <p>Those that fall below a state's reporting threshold for disclosing identifying information about the donor. For example: a contributor who gives $60 in a state where the disclosure reporting threshold is $100 is not required to be identified by name. The $60 is instead lumped in with other contributions that are below $100, and then classified as “unitemized.”</p>
+            <div class="row justify-content-center">
             <div id="barChart"></div>
           </div>
           <div class="row justify-content-center">
Index: js/treeMap.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>/* * * * * * * * * * * * * *\n *         TreeMap         *\n * * * * * * * * * * * * * */\n\nclass TreeMap {\n  // constructor method to initialize Timeline object\n  constructor(_parentElement, _data) {\n    this.parentElement = _parentElement;\n    this.data = _data;\n    this.displayData = [];\n    this.wrangledData = [];\n    this.treeData = [];\n\n    // call initVis method\n    this.initVis();\n  }\n  initVis() {\n    let vis = this;\n\n    // margin conventions\n    vis.margin = { top: 10, right: 50, bottom: 10, left: 50};\n    vis.width =\n      1000 -\n      vis.margin.left -\n      vis.margin.right;\n    vis.height = 600 - vis.margin.top - vis.margin.bottom;\n    // vis.height = document.getElementById(vis.parentElement).getBoundingClientRect().height - vis.margin.top - vis.margin.bottom;\n\n    // init drawing area\n    vis.svg = d3\n      .select(\"#\" + vis.parentElement)\n      .append(\"svg\")\n      .attr(\"width\", vis.width + vis.margin.left + vis.margin.right)\n      .attr(\"height\", vis.height + vis.margin.top + vis.margin.bottom)\n      .append(\"g\")\n      .attr(\n        \"transform\",\n        \"translate(\" + vis.margin.left + \",\" + vis.margin.top + \")\"\n      );\n\n    // append tooltip\n    vis.tooltip = d3\n      .select(\"body\")\n      .append(\"div\")\n      .attr(\"class\", \"tooltip\")\n      .attr(\"id\", \"pieTooltip\");\n\n    // append title\n    d3.select(\"#tree-map-title\").text(\n        \"Finance, Government Agencies, and Lawyers Contribute the most\"\n    );\n\n    vis.wrangleData();\n\n    d3.select(\"#map-tree-select\").on(\"change\", () => vis.updateVis());\n  }\n\n  wrangleData() {\n    let vis = this;\n\n    // subset data to broad_sector and $, rename columns\n    vis.displayData = vis.data.map((row) => [\n      row[\"broad_sector\"],\n      row[\"total_$\"],\n    ]);\n    vis.displayData = vis.displayData.map((item) => ({\n      group: item[\"0\"],\n      value: item[\"1\"],\n    }));\n\n    // extract contribution amount\n    vis.displayData.forEach((row) => {\n      var money = row.value;\n      row.value = Number(money.replace(/[^0-9\\.-]+/g, \"\"));\n    });\n\n    // aggregate $ by broad_sector\n    const groupedSum = vis.displayData.reduce((accumulator, currentValue) => {\n      const { group, value } = currentValue;\n\n      // Check if the group is already in the accumulator\n      // Initialize the sum for the group if not present\n      if (!accumulator[group]) accumulator[group] = 0;\n\n      // Add the value to the sum for the current group\n      accumulator[group] += value;\n\n      return accumulator;\n    }, {});\n\n    // convert to array\n    const myArray = Object.keys(groupedSum).map((key) => ({\n      key,\n      value: groupedSum[key],\n    }));\n\n    // create data for treeMap\n    vis.wrangledData = myArray.map((item) => ({\n      name: item.key,\n      parent: \"Origin\",\n      value: String(item.value),\n    }));\n\n    // add parent node\n    const origin = { name: \"Origin\", parent: \"\", value: \"\" };\n    vis.wrangledData.push(origin);\n\n    vis.wrangledData.columns = [\"name\", \"parent\", \"value\"];\n    console.log(\"my data\", vis.wrangledData);\n\n    vis.updateVis();\n  }\n\n  updateVis() {\n    let vis = this;\n\n    // filter data according to user selection\n    var map_select = document.getElementById(\"map-tree-select\")\n        var map = map_select.options[map_select.selectedIndex].value;\n\n    if(map === \"none\") {\n      vis.treeData = vis.wrangledData.filter(d => (d.name !== \"UNITEMIZED CONTRIBUTIONS\" && d.name !== \"UNCODED\"))\n    } else if(map === \"unitemized\"){\n      vis.treeData = vis.wrangledData.filter(d => d.name !== \"UNCODED\")\n    } else if(map === \"uncoded\"){\n      vis.treeData = vis.wrangledData.filter(d => d.name !== \"UNITEMIZED CONTRIBUTIONS\")\n    } else vis.treeData = vis.wrangledData\n\n    console.log(\"my tree data\", vis.treeData);\n\n    // stratify the data: reformatting for d3.js\n    // BUG SOMEWHERE BETWEEN HERE\n    vis.root = d3\n      .stratify()\n      .id((d) => d.name) // Name of the entity (column name is name in csv)\n      .parentId((d) => d.parent)(\n      // Name of the parent (column name is parent in csv)\n      vis.treeData\n    );\n    vis.root.sum((d) => +d.value); // Compute the numeric value for each entity\n\n    // Then d3.treemap computes the position of each element of the hierarchy\n    // The coordinates are added to the root object above\n    d3.treemap().size([vis.width, vis.width]).padding(4)(vis.root);\n\n    // console.log(\"my root\", vis.root);\n\n    // console.log(\"my leaves\", vis.root.leaves());\n    // use this information to add rectangles:\n    vis.svg\n      .selectAll(\"rect\")\n      .data(vis.root.leaves())\n      .enter()\n      .append(\"rect\")\n      .attr(\"x\", function (d) {\n        return d.x0;\n      })\n      .attr(\"y\", function (d) {\n        return d.y0;\n      })\n      .attr(\"width\", function (d) {\n        return d.x1 - d.x0;\n      })\n      .attr(\"height\", function (d) {\n        return d.y1 - d.y0;\n      })\n      .style(\"stroke\", \"black\")\n      .style(\"fill\", \"#69b3a2\")\n      .on(\"mouseover\", function (event, d, i) {\n        // change the segment of tree map\n        d3.select(this)\n          .attr(\"stroke-width\", \"2px\")\n          .attr(\"stroke\", \"black\")\n          .attr(\"fill\", \"rgba(173,222,255,0.62)\");\n\n        // update tooltip\n        vis.tooltip\n          .style(\"opacity\", 1)\n          .style(\"left\", event.pageX + 20 + \"px\")\n          .style(\"top\", event.pageY + \"px\").html(`\n                        <div style=\"border: thin solid grey; border-radius: 5px; background: lightgrey; padding: 20px\">\n                             <p> Broad Sector: ${d.data.name}</p>\n                             <p> Total donation: ${d.data.value}</p>\n                        </div>`);\n      })\n      .on(\"mouseout\", function (event, d) {\n        d3.select(this).attr(\"stroke-width\", \"0px\").attr(\"fill\", \"#69b3a2\");\n\n        vis.tooltip\n          .style(\"opacity\", 0)\n          .style(\"left\", 0)\n          .style(\"top\", 0)\n          .html(``);\n      });\n\n    // and to add the text labels\n    vis.svg\n      .selectAll(\"text\")\n      .data(vis.root.leaves())\n      .enter()\n      .append(\"text\")\n      .attr(\"x\", function (d) {\n        return d.x0 + 10;\n      }) // +10 to adjust position (more right)\n      .attr(\"y\", function (d) {\n        return d.y0 + 20;\n      }) // +20 to adjust position (lower)\n      .text(function (d) {\n        return d.data.name;\n      })\n      .attr(\"font-size\", \"15px\")\n      .attr(\"fill\", \"white\");\n  }\n}\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/js/treeMap.js b/js/treeMap.js
--- a/js/treeMap.js	(revision 2c20c8b30e9d2dca31deede61497560c2c7f4fae)
+++ b/js/treeMap.js	(date 1701398652640)
@@ -24,7 +24,7 @@
       vis.margin.left -
       vis.margin.right;
     vis.height = 600 - vis.margin.top - vis.margin.bottom;
-    // vis.height = document.getElementById(vis.parentElement).getBoundingClientRect().height - vis.margin.top - vis.margin.bottom;
+    //vis.height = document.getElementById(vis.parentElement).getBoundingClientRect().height - vis.margin.top - vis.margin.bottom;
 
     // init drawing area
     vis.svg = d3
@@ -141,7 +141,7 @@
 
     // Then d3.treemap computes the position of each element of the hierarchy
     // The coordinates are added to the root object above
-    d3.treemap().size([vis.width, vis.width]).padding(4)(vis.root);
+    d3.treemap().size([vis.width, vis.height]).padding(4)(vis.root);
 
     // console.log("my root", vis.root);
 
@@ -150,8 +150,7 @@
     vis.svg
       .selectAll("rect")
       .data(vis.root.leaves())
-      .enter()
-      .append("rect")
+      .join("rect")
       .attr("x", function (d) {
         return d.x0;
       })
@@ -197,8 +196,7 @@
     vis.svg
       .selectAll("text")
       .data(vis.root.leaves())
-      .enter()
-      .append("text")
+        .join("text")
       .attr("x", function (d) {
         return d.x0 + 10;
       }) // +10 to adjust position (more right)
